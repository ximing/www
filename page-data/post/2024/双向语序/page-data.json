{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/post/2024/双向语序/","result":{"data":{"site":{"siteMetadata":{"title":"一席之地","author":"xi ming"}},"markdownRemark":{"id":"8baa0817-4346-564c-b401-d1cd25c4c055","excerpt":"什么是双向语序？ 双向语序（Bidirectional Text）是指在同一文本段落中混合存在两种书写方向的现象： RTL（Right-to-Left）：从右向左书写的语言（如阿拉伯语、希伯来语） LTR（Left-to-Right…","html":"<h2 id=\"什么是双向语序\" style=\"position:relative;\">什么是双向语序？<a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8C%E5%90%91%E8%AF%AD%E5%BA%8F\" aria-label=\"什么是双向语序 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<p>双向语序（Bidirectional Text）是指在同一文本段落中<strong>混合存在两种书写方向</strong>的现象：</p>\n<ul>\n<li><strong>RTL（Right-to-Left）</strong>：从右向左书写的语言（如阿拉伯语、希伯来语）</li>\n<li><strong>LTR（Left-to-Right）</strong>：从左向右书写的语言（如英语、中文）</li>\n</ul>\n<p>当这两种方向的文字混合使用时，会出现复杂的文本方向嵌套问题。例如：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">اللغة العربية (Arabic) 和 English 混合显示</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3 id=\"1-unicode双向算法uba\" style=\"position:relative;\">1. Unicode双向算法（UBA）<a href=\"#1-unicode%E5%8F%8C%E5%90%91%E7%AE%97%E6%B3%95uba\" aria-label=\"1 unicode双向算法uba permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p>Unicode标准通过<strong>逻辑顺序存储+视觉顺序渲染</strong>的机制实现双向支持：</p>\n<ul>\n<li><strong>逻辑顺序</strong>：按字符输入顺序存储（内存中的二进制序列）</li>\n<li><strong>视觉顺序</strong>：根据算法动态计算展示顺序（屏幕上的显示效果）</li>\n</ul>\n<h3 id=\"2-字符类型分类\" style=\"position:relative;\">2. 字符类型分类<a href=\"#2-%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB\" aria-label=\"2 字符类型分类 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p>Unicode将字符分为一下四类，决定其在双向文本中的行为：</p>\n<table>\n<thead>\n<tr>\n<th><strong>字符类型</strong></th>\n<th>算法逻辑</th>\n<th>示例</th>\n<th>Unicode 官方说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>强字符</strong></td>\n<td>强字符自带明确的 LTR 或 RTL 属性，不受上下问干扰</td>\n<td>Hello 你好 مرحباً -</td>\n<td><strong>Strong characters</strong> are those with a definite direction. Examples of this type of character include most alphabetic characters, syllabic characters, Han ideographs, non-European or non-Arabic digits, and punctuation characters <em>that are specific to only those scripts</em>.</td>\n</tr>\n<tr>\n<td><strong>弱字符</strong></td>\n<td>弱字符会跟随上下文内容决定逻辑语序为RTL或LTR。<strong>在混排场景下容易出现语序展示异常问题</strong></td>\n<td>+-×÷ ￥$€ 1234567890</td>\n<td><strong>Weak characters</strong> are those with vague direction. Examples of this type of character include European digits, Eastern Arabic-Indic digits, arithmetic symbols, and currency symbols.</td>\n</tr>\n<tr>\n<td><strong>中性字符</strong></td>\n<td>中性字符没有方向属性</td>\n<td>（tab） （空格）: , . | 。</td>\n<td><strong>Neutral characters</strong> have direction indeterminable without context. Examples include paragraph separators, tabs, and most other whitespace characters. Punctuation symbols that are common to many scripts, such as the colon, comma, full-stop, and the no-break-space also fall within this category.</td>\n</tr>\n<tr>\n<td><strong>显式格式化</strong></td>\n<td>又称“假强字符”，在文本展示中没有符号显式，用户不可见，但是会占用2个字符长度。<br><br><strong>可以用来修正弱字符的展示顺序。</strong></td>\n<td>“\\u202A \\u202C”</td>\n<td><strong>Explicit formatting</strong> characters, also referred to as “directional formatting characters”, are special Unicode sequences that direct the algorithm to modify its default behavior. These characters are subdivided into “marks”, “embeddings”, “isolates”, and “overrides”. Their effects continue until the occurrence of either a paragraph separator, or a “pop” character.</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-方向控制标记\" style=\"position:relative;\">3. 方向控制标记<a href=\"#3-%E6%96%B9%E5%90%91%E6%8E%A7%E5%88%B6%E6%A0%87%E8%AE%B0\" aria-label=\"3 方向控制标记 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p>一言蔽之：本质是通过Unicode符号显式分隔字符标记起始点，对字符的书写方向进行定义，使文本内容始终按照标记的方向进行展示，而不受段落上下文影响。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// 示例：包裹LTR文本使其在RTL环境中保持方向</span>\n<span class=\"token keyword\">const</span> address <span class=\"token operator\">=</span> <span class=\"token string\">\"\\u202A15 Bay Street, Laurel, CA\\u202C\"</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"unicode符号表\" style=\"position:relative;\"><strong>Unicode符号表</strong><a href=\"#unicode%E7%AC%A6%E5%8F%B7%E8%A1%A8\" aria-label=\"unicode符号表 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>方向</th>\n<th>Unicode Code</th>\n<th>HTML Code</th>\n<th>模式</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Left-To-Right Mark(LRM)</td>\n<td>左->右</td>\n<td>U+200E</td>\n<td>‎‎(实体是‎)</td>\n<td>隐性</td>\n</tr>\n<tr>\n<td>Right-To-Left Mark(RLM)</td>\n<td>右->左</td>\n<td>U+200F</td>\n<td>‏(实体是‏)</td>\n<td>隐性</td>\n</tr>\n<tr>\n<td>Left-To-Right Embedding(LRE)</td>\n<td>左->右</td>\n<td>U+202A</td>\n<td>‪ordir =“ltr”</td>\n<td>显性</td>\n</tr>\n<tr>\n<td>Right-To-Left Embedding(RLE)</td>\n<td>右->左</td>\n<td>U+202B</td>\n<td>‫ordir =“rtl”</td>\n<td>显性</td>\n</tr>\n<tr>\n<td>Left-To-Right Override(LRO)</td>\n<td>左->右</td>\n<td>U+202D</td>\n<td>‭or<bdo dir =\"ltr\"></td>\n<td>显性</td>\n</tr>\n<tr>\n<td>Right-To-Left Override(RLO)</td>\n<td>右->左</td>\n<td>U+202E</td>\n<td>‮or<bdo dir =\"rtl\"></td>\n<td>显性</td>\n</tr>\n<tr>\n<td>Left-To-Right Isolate(LRI)</td>\n<td>左->右</td>\n<td>U+2066</td>\n<td>⁦or<bdi dir =\"ltr\"></td>\n<td>显性</td>\n</tr>\n<tr>\n<td>Right-To-Left Isolate(RLI)</td>\n<td>右->左</td>\n<td>U+2067</td>\n<td>⁧or<bdi dir =\"rtl\"></td>\n<td>显性</td>\n</tr>\n<tr>\n<td>First Strong Isolate(FSI)</td>\n<td></td>\n<td>U+2068</td>\n<td>⁨ordir =“auto”</td>\n<td>显性</td>\n</tr>\n<tr>\n<td>Pop Directional Formatting(PDF)</td>\n<td>结束标记</td>\n<td>U+202C</td>\n<td>‬or</bdo></td>\n<td>显性</td>\n</tr>\n<tr>\n<td>Pop Directional Isolate(PDI)</td>\n<td>结束标记</td>\n<td>U+2069</td>\n<td>⁩or</bdi></td>\n<td>显性</td>\n</tr>\n<tr>\n<td>## 常见问题与解决方案</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"1-文字顺序混乱\" style=\"position:relative;\">1. 文字顺序混乱<a href=\"#1-%E6%96%87%E5%AD%97%E9%A1%BA%E5%BA%8F%E6%B7%B7%E4%B9%B1\" aria-label=\"1 文字顺序混乱 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p><strong>典型场景</strong>：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">原文：\"15 Bay Street\" 插入阿拉伯语段落\n错误显示：\"Street Bay 15\"</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p><strong>根本原因</strong>：</p>\n<ul>\n<li>数字(弱字符)与字母(强字符)混合</li>\n<li>中性空格符继承主文方向</li>\n</ul>\n<p><strong>解决方案</strong>：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// 使用LRE+PDF包裹整个地址</span>\n<span class=\"token keyword\">const</span> fixedAddress <span class=\"token operator\">=</span> <span class=\"token string\">\"\\u202A15 Bay Street\\u202C\"</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"2-嵌套方向错乱\" style=\"position:relative;\">2. 嵌套方向错乱<a href=\"#2-%E5%B5%8C%E5%A5%97%E6%96%B9%E5%90%91%E9%94%99%E4%B9%B1\" aria-label=\"2 嵌套方向错乱 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p><strong>典型场景</strong>：</p>\n<p>英文引用阿拉伯语句子中的英文术语</p>\n<p><strong>错误表现</strong>：\nParent (RTL) -> Child (LTR) -> Grandchild (RTL) 嵌套失败</p>\n<p><strong>解决方案</strong>：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- 使用隔离标记建立独立方向上下文 --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rtl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  父文本\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bdi</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ltr<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>子文本 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bdi</span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rtl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>孙文本<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bdi</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bdi</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"3-标点符号错位\" style=\"position:relative;\">3. 标点符号错位<a href=\"#3-%E6%A0%87%E7%82%B9%E7%AC%A6%E5%8F%B7%E9%94%99%E4%BD%8D\" aria-label=\"3 标点符号错位 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p><strong>典型场景</strong>：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">阿拉伯语句尾的英文问号显示在左侧：\"ماذا حدث?‎\"\n正确显示应为：\"ماذا حدث؟‎\"</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p><strong>解决方案</strong>：</p>\n<ul>\n<li>使用语言专属标点（阿拉伯语问号؟）</li>\n<li>添加RLM控制符：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> fixedText <span class=\"token operator\">=</span> <span class=\"token string\">\"ماذا حدث\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\u200F?\\u200F\"</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3 id=\"4-数字显示异常\" style=\"position:relative;\">4. 数字显示异常<a href=\"#4-%E6%95%B0%E5%AD%97%E6%98%BE%E7%A4%BA%E5%BC%82%E5%B8%B8\" aria-label=\"4 数字显示异常 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p><strong>典型场景</strong>：\n阿拉伯语中的欧洲数字”123”显示为”321”</p>\n<p><strong>解决方案</strong>：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// 使用阿拉伯-印度数字（٠١٢٣٤٥٦٧٨٩）</span>\n<span class=\"token keyword\">const</span> arabicNumbers <span class=\"token operator\">=</span> <span class=\"token string\">\"١٢٣\"</span><span class=\"token punctuation\">;</span> \n<span class=\"token comment\">// 或强制指定方向</span>\n<span class=\"token keyword\">const</span> fixedNumbers <span class=\"token operator\">=</span> <span class=\"token string\">\"\\u202A123\\u202C\"</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"各技术栈能力\" style=\"position:relative;\">各技术栈能力<a href=\"#%E5%90%84%E6%8A%80%E6%9C%AF%E6%A0%88%E8%83%BD%E5%8A%9B\" aria-label=\"各技术栈能力 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<table>\n<thead>\n<tr>\n<th>技术栈</th>\n<th>API</th>\n<th>方案说明</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Web</td>\n<td><strong><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/unicode-bidi\">unicode-bidi</a></strong></td>\n<td><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS\">CSS</a> <strong>unicode-bidi</strong> 属性，和 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/direction\">direction</a> 属性，决定如何处理文档中的双书写方向文本（bidirectional text）。比如，如果一块内容同时包含有从左到右书写和从右到左书写的文本，那么用户代理（the user-agent）会使用复杂的 Unicode 算法来决定如何显示文本。unicode-bidi 属性会覆盖此算法，允许开发人员控制文本嵌入（text embedding）。<br><br>unicode-bidi 与 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/direction\">direction</a> 是仅有的两个不受 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/all\">all</a> 简写影响的属性。<br><br><code class=\"language-text\">&lt;br>/* 关键字值 */&lt;br>unicode-bidi: normal;&lt;br>unicode-bidi: embed;&lt;br>unicode-bidi: isolate;&lt;br>unicode-bidi: bidi-override;&lt;br>unicode-bidi: isolate-override;&lt;br>unicode-bidi: plaintext;&lt;br>/* 全局值 */&lt;br>unicode-bidi: inherit;&lt;br>unicode-bidi: initial;&lt;br>unicode-bidi: unset;&lt;br></code></td>\n<td>默认情况下，浏览器会通过RTL标签自动识别文字和布局方向。<br><br>对于识别异常的场景，需要通过特殊处理来进行修正。</td>\n</tr>\n<tr>\n<td>Java</td>\n<td><a href=\"https://unicode-org.github.io/icu-docs/apidoc/dev/icu4j/com/ibm/icu/text/Bidi.html\">Bidi</a><br><br><a href=\"https://docs.oracle.com/javase/8/docs/api/java/text/BreakIterator.html\">BreakIterator</a></td>\n<td>- <a href=\"https://unicode-org.github.io/icu-docs/apidoc/dev/icu4j/com/ibm/icu/text/Bidi.html\">Bidi</a> 是Java ICU工具包提供的能力，基于 <a href=\"https://www.unicode.org/reports/tr9/\">Unicode Standard Annex #9</a>. 算法封装。<br>    <br>- BreakIterator 用于设置字符边界</td>\n<td>Java标准ICU工具包</td>\n</tr>\n<tr>\n<td>iOS</td>\n<td>NSString</td>\n<td><a href=\"https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPInternational/SupportingRight-To-LeftLanguages/SupportingRight-To-LeftLanguages.html\">iOS：SupportingRight-To-LeftLanguages</a><br><a href=\"https://developer.apple.com/documentation/uikit/uitextinput/1614563-setbasewritingdirection\">setbasewritingdirection</a>：文字方向为基础能力，无法彻底解决混排问题。<br><br><strong>Unicode标记</strong><br><br><code class=\"language-text\">&lt;br>// Wrap the plus (+) prefix and phone number in left-to-right directional markers&lt;br>NSString *phoneNumber = @\"408-555-1212\";&lt;br>NSString *localizedPhoneNumber = [NSString stringWithFormat:@\"\\u202A%@\\u202C\", phoneNumber];&lt;br></code></td>\n<td>手动控制</td>\n</tr>\n<tr>\n<td>Android</td>\n<td><a href=\"https://developer.android.com/reference/android/text/BidiFormatter\">BidiFormatter</a></td>\n<td><strong>根据文本中强字符的方向，为非强字符添加方向属性，避免文本占位嵌入时展示错乱。</strong><br><br>如：LTR文本中包含了数字、空格等非强字符，在将这段话插入到RTL文本中时，可能会导致LTR文本中的非强字符被上下文RTL强字符影响，导致展示错乱。</td>\n<td>基于ICU能力封装</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"参考\" style=\"position:relative;\">参考<a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<ul>\n<li><a href=\"http://www.unicode.org/reports/tr9/\">Unicode Standards Annex #9</a></li>\n</ul>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Bidirectional_text\">https://en.wikipedia.org/wiki/Bidirectional_text</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/dir\">https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/dir</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/unicode-bidi\">https://developer.mozilla.org/zh-CN/docs/Web/CSS/unicode-bidi</a></li>\n<li><a href=\"https://www.etymonline.com/word/bidirectional#etymonline_v_27087\">https://www.etymonline.com/word/bidirectional#etymonline_v_27087</a></li>\n<li><a href=\"https://leancode.co/blog/right-to-left-in-react\">https://leancode.co/blog/right-to-left-in-react</a></li>\n<li><a href=\"https://www.w3.org/International/articles/inline-bidi-markup/uba-basics\">https://www.w3.org/International/articles/inline-bidi-markup/uba-basics</a></li>\n<li><a href=\"https://www.w3.org/International/articles/strings-and-bidi/\">https://www.w3.org/International/articles/strings-and-bidi/</a></li>\n<li><a href=\"https://www.npmjs.com/package/bidi-js\">https://www.npmjs.com/package/bidi-js</a></li>\n</ul>","fields":{"slug":"/post/2024/双向语序/"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8C%E5%90%91%E8%AF%AD%E5%BA%8F\">什么是双向语序？</a></p>\n<ul>\n<li><a href=\"#1-unicode%E5%8F%8C%E5%90%91%E7%AE%97%E6%B3%95uba\">1. Unicode双向算法（UBA）</a></li>\n<li><a href=\"#2-%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB\">2. 字符类型分类</a></li>\n<li><a href=\"#3-%E6%96%B9%E5%90%91%E6%8E%A7%E5%88%B6%E6%A0%87%E8%AE%B0\">3. 方向控制标记</a></li>\n<li><a href=\"#unicode%E7%AC%A6%E5%8F%B7%E8%A1%A8\"><strong>Unicode符号表</strong></a></li>\n<li><a href=\"#1-%E6%96%87%E5%AD%97%E9%A1%BA%E5%BA%8F%E6%B7%B7%E4%B9%B1\">1. 文字顺序混乱</a></li>\n<li><a href=\"#2-%E5%B5%8C%E5%A5%97%E6%96%B9%E5%90%91%E9%94%99%E4%B9%B1\">2. 嵌套方向错乱</a></li>\n<li><a href=\"#3-%E6%A0%87%E7%82%B9%E7%AC%A6%E5%8F%B7%E9%94%99%E4%BD%8D\">3. 标点符号错位</a></li>\n<li><a href=\"#4-%E6%95%B0%E5%AD%97%E6%98%BE%E7%A4%BA%E5%BC%82%E5%B8%B8\">4. 数字显示异常</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%90%84%E6%8A%80%E6%9C%AF%E6%A0%88%E8%83%BD%E5%8A%9B\">各技术栈能力</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%8F%82%E8%80%83\">参考</a></p>\n</li>\n</ul>","frontmatter":{"title":"双向语序","date":"December 07, 2024","description":null},"wordCount":{"words":489,"paragraphs":47,"sentences":58}}},"pageContext":{"slug":"/post/2024/双向语序/","previous":{"fields":{"slug":"/post/2024/国际化-RTL/"},"frontmatter":{"title":"国际化-RTL","tags":["国际化"],"description":null}},"next":{"fields":{"slug":"/post/2025/01-01-langgraph/"},"frontmatter":{"title":"langgraph思考","tags":["langchain","AI"],"description":null}}}},"staticQueryHashes":["1006016363","324394502","63159454"],"slicesMap":{}}