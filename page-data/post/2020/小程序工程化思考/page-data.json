{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/post/2020/小程序工程化思考/","result":{"data":{"site":{"siteMetadata":{"title":"一席之地","author":"xi ming"}},"markdownRemark":{"id":"a9450ec4-296d-5d0b-8af2-bfa616955c31","excerpt":"和传统工程化对比 先看下传统前端工程化关注的事情 (from umi)\nimage.png image.png 小程序可做的就相对很少，源于技术本身的约束性，我们做一个对比： 框架角度：目前市面上有 kbone，taro，remax/r2m，mpvue，mpx…","html":"<h2 id=\"和传统工程化对比\" style=\"position:relative;\">和传统工程化对比<a href=\"#%E5%92%8C%E4%BC%A0%E7%BB%9F%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AF%B9%E6%AF%94\" aria-label=\"和传统工程化对比 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<p>先看下传统前端工程化关注的事情 (from umi)\n<img src=\"https://asset-cdn.oss-cn-beijing.aliyuncs.com/imgs/20230605125227.png\" alt=\"image.png\"></p>\n<p><img src=\"https://asset-cdn.oss-cn-beijing.aliyuncs.com/imgs/20230605125232.png\" alt=\"image.png\"></p>\n<p>小程序可做的就相对很少，源于技术本身的约束性，我们做一个对比：</p>\n<ol>\n<li>框架角度：目前市面上有 kbone，taro，remax/r2m，mpvue，mpx等等选择，从优选业务场景覆盖的移动设备角度看均有明显的体验问题或不再维护，所以目前还是基于原生框架进行开发，从小程序不提供操作视图的底层api，不提供组件层级管理关系，不提供模板递归，限定包大小，固定的路由模型等等的约束性看，这也可能是微信比较推荐的做法。</li>\n<li>TS：目前是一个问题，没有最佳的TS规范，小程序原生的TS方式并不能很好的适应复杂场景的开发</li>\n<li>样式(css)： 因为没有视图层的接口，所以没有过多的选择，微信本身提供了 @import等模块化管理的能力，为了包大小，只能使用postcss+变量插件(或css变量)的方式进行样式管理</li>\n<li>JS编译/模块打包/压缩: 这是一个可以做的事情，webpack并不适用于小程序，这部分需要自研 传统基于babel的有mpbuild或者现代的基于esbuild/swc的mpe</li>\n<li>路由管理/请求库： 均强制限制在小程序框架提供的方案，灵活性低</li>\n<li>资源加载方式：固化为小程序主包，子包的形式，最新版基础库提供了动态加载的能力，有两个问题\n<ol>\n<li>对基础库有要求的小程序都无法使用</li>\n<li>是一个比较限制的方案，并做传统微前端架构那样从远端加载代码</li>\n</ol>\n</li>\n<li>数据流：可能是一个可以做的事情，不过小程序本身不具备context的能力，实现出来的对比传统前端的易用性不是很好</li>\n<li>代码风格：eslint prettier 等最佳实践</li>\n<li>文档能力/通用组件开发能力：需要做的事情</li>\n<li>测试：可能需要做，不过一般在业务团队因为ROI不高，所以不被重视</li>\n</ol>\n<p>这样对比下来，就明显能感受到，我们在传统工程化上能做的事情比较少，更多的是要关注业务集成&#x26;业务领域的一些能力的建设。</p>\n<h2 id=\"小程序框架对比传统前端框架缺少什么\" style=\"position:relative;\">小程序框架对比传统前端框架缺少什么<a href=\"#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94%E4%BC%A0%E7%BB%9F%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E7%BC%BA%E5%B0%91%E4%BB%80%E4%B9%88\" aria-label=\"小程序框架对比传统前端框架缺少什么 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<table>\n<thead>\n<tr>\n<th>小程序</th>\n<th>前端</th>\n<th>问题</th>\n<th>能否对齐</th>\n<th>是否必要</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>启动流程</td>\n<td>固定的 app → page 生命周期<strong>同步</strong>调用</td>\n<td>任意编排</td>\n<td>小程序在启动阶段有异步的依赖关系时时处理会很复杂</td>\n<td>不能</td>\n</tr>\n<tr>\n<td>code split</td>\n<td>包维度</td>\n<td>任意切分</td>\n<td>不能</td>\n<td>否</td>\n</tr>\n<tr>\n<td>加载能力</td>\n<td>支持 <a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/async.html\">分包异步化</a> ，且必须提前构建到一起，支持2.17.3及以上</td>\n<td>支持从网络加载包</td>\n<td>微应用拆分无法绕过集成构建</td>\n<td>不能</td>\n</tr>\n<tr>\n<td>编排能力</td>\n<td>page+component</td>\n<td>任意编排</td>\n<td>不能</td>\n<td>是</td>\n</tr>\n<tr>\n<td>组件能力</td>\n<td>缺失 <a href=\"https://developers.weixin.qq.com/community/develop/doc/000ec0688e466071b858fed7f56c00\">slot能力</a></td>\n<td>~</td>\n<td>不能</td>\n<td>是</td>\n</tr>\n<tr>\n<td>组件间通讯</td>\n<td>props+父节点中转</td>\n<td>props和context能力</td>\n<td>能</td>\n<td>是</td>\n</tr>\n<tr>\n<td>视图介入</td>\n<td>不可以直接操作视图</td>\n<td>可以直接操作dom</td>\n<td>小程序底层能力缺失导致动态能力很难有性能保障</td>\n<td>性能考虑不能</td>\n</tr>\n<tr>\n<td>动态执行JS</td>\n<td>不支持</td>\n<td>eval等</td>\n<td>能</td>\n<td>是</td>\n</tr>\n<tr>\n<td>路由</td>\n<td>固化 page → page + tabbar</td>\n<td>任意自定义</td>\n<td>无法做到贴合业务场景做编排</td>\n<td>不能</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"演进视角看小程序当下成熟度对比\" style=\"position:relative;\">演进视角看小程序当下成熟度对比<a href=\"#%E6%BC%94%E8%BF%9B%E8%A7%86%E8%A7%92%E7%9C%8B%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BD%93%E4%B8%8B%E6%88%90%E7%86%9F%E5%BA%A6%E5%AF%B9%E6%AF%94\" aria-label=\"演进视角看小程序当下成熟度对比 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<blockquote>\n<p>2021 增补</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>第一阶段：14年~17年</th>\n<th>第二阶段：18年~21年</th>\n<th>第三阶段：21年后</th>\n<th>核心</th>\n<th>小程序能力</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>框架</td>\n<td>范式转移，vdom 提出 代表：react vue2</td>\n<td>范式转移，编译时代替运行时 vdom 代表：<a href=\"https://www.sveltejs.cn/\">svelte</a> <a href=\"https://www.solidjs.com/\">solidjs</a></td>\n<td>范式转移，去除 JS 运行时开销 代表：<a href=\"https://qwik.builder.io/\">qwik</a></td>\n<td>更好的性能</td>\n<td>还处于第一阶段</td>\n</tr>\n<tr>\n<td>框架理念</td>\n<td>class+声明式框架+TS 支持 代表：react&#x3C;0.14，vue2</td>\n<td>function 代表：react>15</td>\n<td>hooks 代表：react 16，vue3</td>\n<td>增强框架对内聚性的表达带来更强的可维护性</td>\n<td>不到第一阶段，可做工</td>\n</tr>\n<tr>\n<td>样式理念</td>\n<td>样式预处理 代表：less scss</td>\n<td>样式后处理 代表：postcss</td>\n<td>样式框架<br><br>代表：tailwindcss</td>\n<td>增强框架对内聚性的表达带来更强的可维护性</td>\n<td>不到第一阶段，可做工</td>\n</tr>\n<tr>\n<td>状态管理</td>\n<td>单向数据流+单store，中心化<br><br>代表：flux，redux，vuex，mobx</td>\n<td>增强ts+多store，去中心化<br><br>代表：mobx，pinia，recoil</td>\n<td>元数据，惰性更新等尝试<br><br>代表：zustand、jotai、valtio</td>\n<td>更好的DX，更好的性能，配合框架理念</td>\n<td>不到第一阶段，可做工</td>\n</tr>\n<tr>\n<td>工具链</td>\n<td>范式转移，依赖分析，打包部署<br><br>代表：webpack</td>\n<td>微创新<br><br>代表：rollup</td>\n<td>效率大幅度提升<br><br>代表：vite</td>\n<td>效率的提升</td>\n<td>不到第一阶段，可做工</td>\n</tr>\n<tr>\n<td>架构</td>\n<td>SPA，SSR<br><br>代表：umi</td>\n<td>微前端，SSR 流式，SSG，ESR<br><br>代表：qiankun</td>\n<td>服务端组件等<br><br>代表：react18</td>\n<td>大规模协同问题<br><br>算力转移提高性能</td>\n<td>不到第一阶段</td>\n</tr>\n</tbody>\n</table>","fields":{"slug":"/post/2020/小程序工程化思考/"},"tableOfContents":"<ul>\n<li><a href=\"#%E5%92%8C%E4%BC%A0%E7%BB%9F%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AF%B9%E6%AF%94\">和传统工程化对比</a></li>\n<li><a href=\"#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94%E4%BC%A0%E7%BB%9F%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E7%BC%BA%E5%B0%91%E4%BB%80%E4%B9%88\">小程序框架对比传统前端框架缺少什么</a></li>\n<li><a href=\"#%E6%BC%94%E8%BF%9B%E8%A7%86%E8%A7%92%E7%9C%8B%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BD%93%E4%B8%8B%E6%88%90%E7%86%9F%E5%BA%A6%E5%AF%B9%E6%AF%94\">演进视角看小程序当下成熟度对比</a></li>\n</ul>","frontmatter":{"title":"小程序工程化思考","date":"2020年12月25日","description":null,"tags":["工程思考","小程序"]},"wordCount":{"words":264,"paragraphs":21,"sentences":21}}},"pageContext":{"slug":"/post/2020/小程序工程化思考/","previous":{"fields":{"slug":"/post/2020/使用TS 开发 JS 虚拟机/"},"frontmatter":{"title":"使用TS 开发 JS 虚拟机","tags":["jsvm","小程序","搭建"],"description":null}},"next":{"fields":{"slug":"/post/2023/04-09-余弦相似度匹配/"},"frontmatter":{"title":"余弦相似度匹配(适用于openai的向量数据库底层实现)","tags":["算法","llm"],"description":null}}}},"staticQueryHashes":["2887002447","3110208747","3255319198","63159454"],"slicesMap":{}}