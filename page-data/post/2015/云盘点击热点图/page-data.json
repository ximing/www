{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/post/2015/云盘点击热点图/","result":{"data":{"site":{"siteMetadata":{"title":"一席之地","author":"xi ming"}},"markdownRemark":{"id":"0b3c9d42-c6fe-5588-b007-bf278e05bc93","excerpt":"最近在云盘中实现了热点上报系统，方便 UED 同学进行针对性的设计，最后成品如下：\nimage.png 实现 采集上报 实现思路很简单，因为云盘使用 react 框架，常规的业务事件都由 react 合成事件代理。所以热点 sdk 可以直接将 在 document 上监听 mouseDown 事件，获取坐标，120…","html":"<p>最近在云盘中实现了热点上报系统，方便 UED 同学进行针对性的设计，最后成品如下：\n<img src=\"https://asset-cdn.oss-cn-beijing.aliyuncs.com/imgs/20230606133929.png\" alt=\"image.png\"></p>\n<h2 id=\"实现\" style=\"position:relative;\">实现<a href=\"#%E5%AE%9E%E7%8E%B0\" aria-label=\"实现 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<h3 id=\"采集上报\" style=\"position:relative;\">采集上报<a href=\"#%E9%87%87%E9%9B%86%E4%B8%8A%E6%8A%A5\" aria-label=\"采集上报 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p>实现思路很简单，因为云盘使用 react 框架，常规的业务事件都由 react 合成事件代理。所以热点 sdk 可以直接将 在 document 上监听 mouseDown 事件，获取坐标，1200 * 800 (设计稿尺寸) 进行上报。大致的伪代码如下</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// 监听页面的点击事件</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 获取点击的原始坐标</span>\n    <span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>pageX<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>pageY<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 获取页面的实际尺寸</span>\n    <span class=\"token keyword\">var</span> pageWidth <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>scrollWidth<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> pageHeight <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>scrollHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 将坐标值缩放到800*1200</span>\n    <span class=\"token keyword\">var</span> scaledX <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">/</span> pageWidth <span class=\"token operator\">*</span> <span class=\"token number\">800</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> scaledY <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>y <span class=\"token operator\">/</span> pageHeight <span class=\"token operator\">*</span> <span class=\"token number\">1200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 打包成对象</span>\n    <span class=\"token keyword\">var</span> reportData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> scaledX<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> scaledY<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 将数据上报到服务器（这里假设你有一个名为 report 的函数来完成数据上报）</span>\n    <span class=\"token function\">report</span><span class=\"token punctuation\">(</span>reportData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"数据清洗\" style=\"position:relative;\">数据清洗<a href=\"#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97\" aria-label=\"数据清洗 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p>数据上报后会送到 kafka 中，有一个 java 任务进行 kafka 消费，数据按照分钟级别存入 mysql 中即可，这个过程需要区分一下版本&#x26;AB 等进行分组</p>\n<h3 id=\"数据展示\" style=\"position:relative;\">数据展示<a href=\"#%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA\" aria-label=\"数据展示 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h3>\n<p>后台设计上传不同版本的设计稿 (1200 * 800) ，根据版本信息去数据库中获取对应时间段的点位信息，通过 echarts 热力图展示即可</p>\n<h2 id=\"可改进\" style=\"position:relative;\">可改进<a href=\"#%E5%8F%AF%E6%94%B9%E8%BF%9B\" aria-label=\"可改进 permalink\" class=\"custom-class after\"><svg t=\"1685947446267\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"4780\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25\" height=\"25\"><path d=\"M282.453333 676.693333m-181.333333 0a181.333333 181.333333 0 1 0 362.666667 0 181.333333 181.333333 0 1 0-362.666667 0Z\" fill=\"#FFCA5F\" p-id=\"4781\"></path><path d=\"M570.453333 111.36m-42.666666 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z\" fill=\"#FFCA5F\" p-id=\"4782\"></path><path d=\"M388.053333 866.346667A208 208 0 0 1 241.066667 512l106.666666-106.666667 45.226667 45.226667-106.666667 106.666667A144 144 0 1 0 490.666667 760.32l107.733333-106.666667 45.226667 45.226667-107.733334 106.666667a207.146667 207.146667 0 0 1-147.84 60.8zM723.413333 617.173333l-45.226666-45.226666 100.906666-100.906667A144 144 0 1 0 576 267.52l-100.906667 100.906667-45.226666-45.44 100.906666-100.906667A208 208 0 0 1 824.32 516.266667z\" fill=\"#5C1CF7\" p-id=\"4783\"></path><path d=\"M442.794667 558.506667l134.570666-134.549334 45.248 45.269334-134.549333 134.549333z\" fill=\"#5C1CF7\" p-id=\"4784\"></path></svg></a></h2>\n<ol>\n<li>滚动</li>\n</ol>\n<p>目前云盘不存在整个页面的滚动行为，所以没有实现滚动下 点击位置的校准</p>","fields":{"slug":"/post/2015/云盘点击热点图/"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E5%AE%9E%E7%8E%B0\">实现</a></p>\n<ul>\n<li><a href=\"#%E9%87%87%E9%9B%86%E4%B8%8A%E6%8A%A5\">采集上报</a></li>\n<li><a href=\"#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97\">数据清洗</a></li>\n<li><a href=\"#%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA\">数据展示</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%8F%AF%E6%94%B9%E8%BF%9B\">可改进</a></p>\n</li>\n</ul>","frontmatter":{"title":"云盘点击热点图","date":"November 12, 2015","description":null},"wordCount":{"words":56,"paragraphs":10,"sentences":10}}},"pageContext":{"slug":"/post/2015/云盘点击热点图/","previous":{"fields":{"slug":"/post/2015/云盘服务端从nodejs 专项 java 相关复盘/"},"frontmatter":{"title":"云盘服务端从nodejs 专项 java 相关复盘","tags":["云盘","nodejs","java"],"description":null}},"next":{"fields":{"slug":"/post/2015/如何分析问题/"},"frontmatter":{"title":"如何分析问题","tags":["方法论"],"description":null}}}},"staticQueryHashes":["1006016363","324394502","63159454"],"slicesMap":{}}